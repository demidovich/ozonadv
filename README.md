# ozonadv

Консольная утилита извлечения статистики по объектам рекламных кампаний Ozon. 

#### Мотивация к разработке

Утилита написана в помощь супруге, которая мучилась с ручной выгрузкой ретроспективых данных объектов рекламных кампаний. На текущий момент (апрель 2025) в UI рекламного кабинета Ozon не существует функционала, позволяющего выгрузить статистику по рекламным объектам нескольких кампаний. Если у вас десяток кампаний это неприятно, но терпимо. Если их количество переваливает за сотню и вам нужны еженедельные отчеты - у вас проблема.

В качестве личной мотивации использовано желание разобраться с тем, как писать консольные утилиты на Go. Я крайне признателен компании Ozon за такой классный кейс. Честно.

#### Особенности Ozon Performance API

В настоящее время для выгрузки ретроспективных данных рекламных кабинетов Ozon действуют следующие ограничения:

1. До получения статистических данных необходимо сформировать запрос на их генерацию.
2. На один рекламный кабинет в единицу времени может обрабатываться 1-5 запросов генерации. Все запросы, выходящие за этот лимит будут получать HTTP 429.
3. Один отчет может формироваться до 10 минут. Чаще всего время генерации составляет 3 минуты. Но, в зависимости нагрузки на базу и количество конкурирующих (соседних) выгрузок в очереди, оно может неконтролируемо увеличиться.

Приятные неожиданности:

1. Для API Ozon не существует "песочницы" (тормоза, поворотники и "песочницы" придумали трусы).
2. Разные отчеты формируются разными хостами.
3. Токен доступа может "протухнуть" через непредсказуемое время.

Уверен, что Ozon уже исправляет эти недчеты и со временем исправит их все. Но на текущий момент (апрель 2025) дела обстоят именно так.

#### Документация Ozon Performance API

https://docs.ozon.ru/api/performance/

#### Реализация

Приложение выполняется в командной строке. Для пользователей, не знающих как выглядит терминал, это будет дискомфортно.

Поскольку на генерацию одного отчета может потребавиться до 10 минут, а одновременное количество генерируемых отчетов небольшое, формирование и загрузка всех данных может занять больше часа. Это, в свою очередь, означает, что работа приложения может быть прервана в любой момент. Для ее возобновление требуется постоянное хранилище данных. Поскольку утилита будет использоваться не разработчиками, docker с базой данных из доступных вариантов исчезает. По этой же причине исчезает возможность создавать конфигурационные файлы (токены доступа в api). 

В качестве хранилища приложение использует локальный диск (директория .ozonadv в домашнем каталоге пользователя). Данные хранятся в формате json. Приложение хранит запросы отчетов и данные кабинетов.
  
Приложение не использует какие-либо модифицирующие запросы api. Весь код обмена с api можно посмотреть в директории проекта internal/infra/ozon.
